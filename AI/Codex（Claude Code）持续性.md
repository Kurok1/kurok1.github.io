# 一份能让 Codex 持续工作的 ToDoList 文档应具备的 6 个要素

1. **北极星目标（North Star）**：一句话说明要交付什么，给谁用，成功是什么样。
    
2. **范围与非范围（Scope / Non-scope）**：明确禁止 Codex 做什么，避免发散。
    
3. **工程事实（Project Facts）**：技术栈、目录结构、约束（端口、数据库、部署方式、代码风格）。
    
4. **任务分解（Backlog）**：按“可交付增量”拆分，每个任务都有输入/输出/验收。
    
5. **执行协议（Working Agreement）**：Codex 每次要做的动作顺序、如何提交变更、如何报告状态。
    
6. **状态记录（State / Changelog）**：已完成、当前进行中、阻塞点、下一步，保证上下文连续。


# 多文档组织

---

## 1) 推荐目录与命名规范

```
/docs
  PROJECT.md
  TODOS.md
  /tasks
    T-001-user-auth.md
    T-002-todo-crud.md
    T-003-filter-sort.md
```

命名建议：

- **TODOS.md 的功能点**用稳定 ID：`F-001 / F-002`
    
- **TASK.md**用稳定 ID：`T-001 / T-002`
    
- 在 TODOS 里每个功能点明确指向一个或多个 TASK：`-> docs/tasks/T-002-todo-crud.md`
    

这样 Codex 在引用、更新、追踪时不容易混乱。

---

## 2) 三份文档的职责边界（避免重叠）

### `PROJECT.md`（全局约束与统一标准，不记录进度）

只放“长期稳定、不随功能变化频繁调整”的内容，例如：

- 技术栈与版本
    
- 目录结构约定
    
- 代码规范（lint/format、命名、模块边界）
    
- 测试规范（必须写哪些测试、覆盖范围、命令）
    
- 提交规范（commit message、PR 要求）
    
- 文档规范（日志格式、任务状态同步规则）
    
- 禁止事项（不引入某些库、不做某些架构）
    

### `TODOS.md`（路线图与功能层面的状态）

放“做什么、先做什么、做到什么程度算完成”：

- Milestones（M0/M1/M2…）
    
- 每个功能点（F-xxx）的范围、验收标准、对应 TASK 列表
    
- 功能完成勾选与功能级更新日志（高层摘要）
    

### `docs/tasks/T-xxx-*.md`（单功能/单增量的执行计划）

放“怎么做、改哪些文件、验收怎么跑、风险与回滚”：

- 实现路径（可以拆成步骤/子任务）
    
- 每一步的产物与验收（命令、预期输出）
    
- 变更清单（文件、接口、迁移）
    
- 任务级更新日志（细节）
    

---

## 3) 最重要：状态同步规则（否则一定会乱）

你提的“每完成一步要打勾 + 写日志”可行，但要定规则：

1. **真相源（Source of Truth）**
    
    - 任务执行细节与完成情况：以 `TASK.md` 为准
        
    - 功能是否完成：以 `TODOS.md` 的功能点勾选为准（但必须满足所有关联 TASK 完成）
        
2. **勾选联动规则**
    
    - `TASK.md` 的步骤全部完成并验收通过 → 该 TASK 标记完成
        
    - 一个功能点 `F-xxx` 关联的所有 TASK 完成 → 才能在 `TODOS.md` 勾选 `F-xxx`
        
3. **日志粒度**
    
    - `TASK.md`：记录“实现细节与文件级变更”，适合回溯
        
    - `TODOS.md`：只记录“用户可感知/里程碑级变化”，不写太细
        
4. **更新顺序（Codex 每次必须遵循）**
    
    - 先更新 `TASK.md`：勾选步骤 + 写任务日志
        
    - 再更新 `TODOS.md`：如果 TASK 完成导致功能完成，再勾选功能点并写功能日志
        
5. **禁止“只打勾不写日志”**
    
    - 每一次勾选必须伴随一条日志，避免状态不可追溯。
        

---

## 4) 给 Codex 的执行协议（强烈建议写进 PROJECT.md）

建议你在 `PROJECT.md` 加一个“Codex Working Agreement”章节，固定要求每次迭代输出：

- 本次目标（只做 1 个 TASK 或 TASK 的 1-3 个步骤）
    
- 变更文件列表（新增/修改）
    
- 运行与验收命令 + 结果
    
- 更新了哪些文档位置（TODOS/TASK 的行或段落）
    
- 如果遇到阻塞：写明“需要的人类决策点”，并停止在安全边界内
    

这会显著降低 Codex 自行扩展范围导致的偏航。

---

## 5) 模板（可直接复制）

### `PROJECT.md` 关键结构建议

- Project Overview
    
- Architecture & Directory Conventions
    
- Coding Standards
    
- Testing Standards
    
- Documentation Standards（含日志格式与同步规则）
    
- Codex Working Agreement（执行协议）
    

### `TODOS.md` 功能点模板（示例）

```md
# TODOS（Roadmap）

## Milestone M1：MVP

### F-002 Todo CRUD（API + 存储）
- 目标：支持创建/编辑/完成/删除 Todo
- 验收：
  - `curl ...` 创建返回 201
  - `curl ...` 列表返回 schema 满足 ...
- 关联任务：
  - [ ] T-002 -> docs/tasks/T-002-todo-crud.md
- 状态：⏳ In Progress

#### 更新日志
- 2026-01-23：创建了任务 T-002，定义数据模型与 API 验收标准。
```

当功能完成时：

- 勾选 F-002（或将“关联任务全部完成”后再勾选）
    
- 追加一条“用户视角”的日志
    

### `TASK.md` 模板（示例）

```md
# T-002 Todo CRUD
关联功能：F-002
状态：⏳ In Progress
负责人：Codex
最后更新：2026-01-23

## 目标与范围
- 实现：Todo 的 CRUD（不含标签/搜索/用户体系）
- Non-scope：分页、复杂权限、协作

## 实现路径（Steps）
- [ ] S1 定义数据模型与迁移
  - 输出：Todo 表/集合定义，迁移脚本
  - 验收：迁移成功；能插入一条记录
- [ ] S2 实现 Create / List API
  - 验收：`curl ...` 返回 201；`curl ...` 返回列表
- [ ] S3 实现 Update / Delete API
  - 验收：更新字段生效；删除后不可查询
- [ ] S4 添加最小测试（冒烟/集成）
  - 验收：`<test command>` 通过

## 变更影响（Impact）
- 影响模块：/server/routes、/db、/tests
- 新增环境变量：无
- 兼容性：新增接口，不破坏现有

## 验收命令（Conformance）
- `...`
- 预期输出：...

## 更新日志
- 2026-01-23：
  - 完成 S1：新增 `...`，迁移命令 `...` 通过
  - 修改文件：...
```

---

## 6) 这个方案“能不能持续工作”的关键风险点与改进

### 风险 A：TODOS“描述所有功能点”会越来越重

改进：TODOS 只保留“路线图 + 当前/近期”。

- 远期功能放“Future”区块，尽量只保留标题与一句话，不展开细节。
    
- 细节永远落到 TASK.md。
    

### 风险 B：一个功能点对应多个 TASK 时，完成条件不清

改进：在 TODOS 的每个功能点写“完成判定”：

- “关联 TASK 全部完成 + 验收清单全部通过”才可勾选功能点。
    

### 风险 C：TASK 过大导致 Codex 一次做不完

改进：TASK 控制在 1–3 次迭代能完成；否则拆成多个 TASK：

- 例如 “Todo CRUD + Filter + UI” 必须拆开。
    

---

# 文档结构生成Agent
下面给一组可直接复制使用的“提示词（Prompts）”，用于让 AI Agent 一次性生成你定义的文档结构模板（`docs/PROJECT.md`、`docs/TODOS.md`、`docs/tasks/T-xxx.md`）。我按“强约束、可执行、可扩展、适配 Codex/Agent 持续迭代”的方式写好，你只需要把尖括号内容替换成你的项目参数即可。

---

## Prompt 1：一键生成整套文档结构（推荐）

```text
你是一个资深软件架构与项目交付负责人。请为一个从0开始的新项目生成“文档驱动 + 任务驱动”的项目管理模板，目标是让 Codex/AI Agent 能持续、多轮迭代推进开发且不跑偏。

请一次性输出以下三个文件的完整内容，并用清晰的文件分隔标记，严格按 Markdown 编写：

1) docs/PROJECT.md
2) docs/TODOS.md
3) docs/tasks/T-001-bootstrap.md（作为示例任务）

我对文档体系的硬性要求如下（必须严格遵守）：
- 采用三层结构：PROJECT（全局约束）、TODOS（功能路线图与状态）、TASK（单功能实现路径与验收）
- TODOS 里每个功能点用稳定 ID：F-001、F-002…；TASK 用稳定 ID：T-001、T-002…
- TODOS 的每个功能点必须包含：目标、范围/非范围、验收标准（可执行命令或明确步骤）、关联任务列表（链接到 tasks 文件）、状态、更新日志
- TASK 文件必须包含：关联功能ID、状态、目标与范围、实现路径 Steps（可勾选，S1/S2…）、每步输出与验收、变更影响、验收命令、更新日志
- 每一次勾选必须附带更新日志；并定义状态同步规则：TASK 的步骤完成 -> TASK 完成；功能点关联 TASK 全部完成 -> 功能点可勾选
- PROJECT.md 必须包含：代码规范、测试规范、目录约定、提交规范、文档规范（日志格式与同步规则）、AI Agent 执行协议（每次迭代必须输出什么）
- 输出内容必须是“可直接落地使用”的模板，不要泛泛而谈；不要引用外部链接；不要包含尚未定义的占位符（除非在“项目参数”区域统一声明）

项目参数如下（据此生成具体模板与命令占位）：
- 项目类型：<Web/API/CLI/移动端>
- 技术栈：<例如 Node.js + Fastify + SQLite 或 Python + FastAPI + Postgres>
- 包管理/构建：<npm/pnpm/uv/poetry/maven等>
- 测试工具：<jest/pytest/go test等>
- 运行方式：<本地/容器化>
- 代码风格：<eslint+prettier/ruff+black等>

额外要求：
- 在 TODOS.md 中给出至少 2 个 Milestones（例如 M0/M1），每个 Milestone 至少 2 个功能点
- 同时在 tasks 目录里除了 T-001 示例任务之外，再“在 TODOS 中预留”T-002、T-003 的链接（但不需要输出它们的文件内容）
- 文档语言使用中文，但技术命令保留英文命令风格
- 输出必须仅包含文件内容，不要在文件之外加解释性文字
```

---

## Prompt 2：只生成 PROJECT.md（全局约束与 Agent 协议）

```text
你是资深工程负责人。请生成 docs/PROJECT.md 的 Markdown 内容，用于一个从0开始的项目，让 Codex/AI Agent 能持续推进开发。

必须包含并具体化以下章节：
- Project Overview（目标与非目标）
- Architecture & Directory Conventions（目录约定，写出示例目录树）
- Coding Standards（命名/模块边界/lint&format/错误处理/日志）
- Testing Standards（测试分层、最低要求、命令、覆盖期望）
- Commit & Change Management（提交信息规范、变更记录要求）
- Documentation Standards（TODOS/TASK 的同步规则、日志格式、ID 规则）
- AI Agent Working Agreement（每次迭代必须遵循的步骤与输出格式：目标、改动文件、验收命令与结果、文档更新位置、阻塞点处理）

项目参数：
- 技术栈：<...>
- 包管理/构建：<...>
- 测试工具：<...>
- 运行方式：<...>
- 代码风格：<...>

要求：中文撰写；命令为英文；内容可直接复制到仓库使用；不要写外部链接。
```

---

## Prompt 3：只生成 TODOS.md（路线图与功能点 + TASK 链接）

```text
你是项目交付负责人。请生成 docs/TODOS.md 的 Markdown 内容，作为项目路线图与功能点状态主文档，供 Codex/AI Agent 持续迭代使用。

硬性结构要求：
- 顶部写明：状态同步规则（TASK->功能点）、日志规则（勾选必须写日志）、ID 规则（F-xxx/T-xxx）
- 至少 2 个 Milestones（M0/M1），每个至少 2 个功能点（F-001…）
- 每个功能点必须包含：目标、范围/非范围、验收标准（可执行命令或明确步骤）、关联任务列表（链接到 docs/tasks/T-xxx-*.md）、状态、更新日志
- 预置任务：T-001（bootstrap）、T-002（核心闭环）、T-003（测试与质量）；提供链接但无需生成任务文件

项目参数：
- 项目类型：<...>
- 技术栈：<...>
- 运行方式：<...>

要求：中文；命令英文；内容可直接用；不要写解释性文字。
```

---

## Prompt 4：生成单个 TASK.md（从功能点自动拆步骤）

```text
你是资深工程实现负责人。请基于以下输入，为一个具体任务生成 docs/tasks/<任务文件名>.md 的完整 Markdown 内容，目标是让 Codex/AI Agent 严格按步骤实施并可验收。

输入：
- 任务ID：T-0XX
- 任务名：<...>
- 关联功能ID：F-0YY
- 技术栈：<...>
- 任务范围：<必须做什么>
- 非范围：<明确不做什么>
- 预期产物：<接口/页面/模块/脚本等>
- 验收方式：<命令/接口调用/手动步骤>
- 影响模块：<目录或模块>
- 风险点：<可选>

输出的 TASK.md 必须包含：
- 元信息：关联功能ID、状态、最后更新日期
- 目标与范围 / Non-scope
- 实现路径 Steps（S1/S2/…，每步都要：输出、验收）
- 变更影响（涉及的目录/文件类型/接口/迁移/环境变量）
- 验收命令（集中列出）
- 更新日志（空但预留格式，注明“每次勾选必须写日志”）

要求：中文；命令英文；可直接落地执行；不要引用外部链接。
```

---

## Prompt 5：让 Agent “生成后立刻自检”（避免模板缺项）

如果你发现 Agent 经常漏章节或不按结构输出，可以在 Prompt 末尾追加这一段自检要求：

```text
在输出完成后，请进行结构自检并用一个“检查清单”确认：
- 是否输出了三个文件且文件名正确
- PROJECT/TODOS/TASK 是否包含所有硬性章节
- TODOS 每个功能点是否包含：目标/范围/验收/任务链接/状态/日志
- TASK 每个步骤是否包含：输出/验收
自检清单必须放在每个文件末尾的“内部校验”章节中（并注明该章节可在实际使用时删除）。
```

---

## 使用建议（让生成更稳定）

- 你可以把“项目参数”固定成一个小块，后续每次生成/更新都复用同样参数，减少漂移。
    
- 你想让 Codex 更稳定地“更新日志 + 打勾”，就把同步规则写进 PROJECT.md 的“Documentation Standards”，并在 TODOS/TASK 顶部重复一行摘要规则（冗余是好事）。
    
